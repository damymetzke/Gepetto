<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core/draw-object.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core/draw-object.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Transform = require("./transform");
const { TransformCommand } = require("./transform-command");

/**
 * the class used to store objects to be drawn.
 * 
 * Each object represents an SVG image.
 * Each object has a name, parent and a transform relative to the parent.
 */
class DrawObject
{
    name;
    parent;
    _relativeTransform = new Transform([1, 0, 0, 1, 0, 0]);
    _dirty = false;
    transformCommands = [];
    // transformCommands = onChange({ dirty: false, commands: [] }, function (path, value, previousValue)
    // {
    //     if (path === "commands")
    //     {
    //         this.dirty = true;
    //     }
    // });

    AddTransformCommand(command)
    {
        this.transformCommands.push(command);
        this._dirty = true;
    }

    /**
     * should be called whenever transformCommands is changed manually.
     * 
     * when calling this function the object is notified that the transform is dirty.
     * The next time the transform is required it will be recalculated.
     */
    OnTransformCommandsUpdate()
    {
        this._dirty = true;
    }

    get relativeTransform()
    {
        if (!this._dirty)
        {
            return this._relativeTransform;
        }

        this._relativeTransform = new Transform([1, 0, 0, 1, 0, 0]);

        for (let i = 0; i &lt; this.transformCommands.length; ++i)
        {
            let tmp = this.transformCommands[i];
            this._relativeTransform = this.transformCommands[i].CreateMatrix().MultiplyMatrix(this._relativeTransform);
        }

        this._dirty = false;

        return this._relativeTransform;
    }

    /**
     * calculate the world transform of the object.
     * 
     * the relative transform stored in this object is in object-space;
     * in order to get the position on screen it needs to be converted to world space.
     * 
     * to convert it to world space the following operation is done:
     * ```
     * parent.transform * this.transform
     * ```
     * 
     * @see Transform#MultiplyMatrix
     * 
     * @returns the transform of the object in world space.
     */
    WorldTransform()
    {
        if (this.parent === null)
        {
            return this.relativeTransform;
        }
        return this.parent.relativeTransform.MultiplyMatrix(this.relativeTransform);
    }

    ToPureObject()
    {
        let result = {
            name: this.name,
            parent: this.parent === null ? null : parent.name,
            transformCommands: []
        };

        for (let i = 0; i &lt; this.transformCommands.length; ++i)
        {
            result.transformCommands.push(this.transformCommands[i].ToPureObject());
        }

        return result;
    }

    FromPureObject(object)
    {
        this.name = object.name;
        this.parent = object.parent;
        this._dirty = true;
        for (let i = 0; i &lt; object.transformCommands.length; ++i)
        {
            let newTransformCommand = new TransformCommand();
            newTransformCommand.FromPureObject(object.transformCommands[i]);
            this.transformCommands.push(newTransformCommand);
        }
    }

    constructor(name, parent = null)
    {
        this.name = name;
        this.parent = parent;
    }
}

module.exports.Transform = Transform;
module.exports.DrawObject = DrawObject;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Core.html">Core</a></li><li><a href="module-DrawObjectXmlhandler.html">DrawObjectXmlhandler</a></li><li><a href="module-ObjectEditor_Main.html">ObjectEditor_Main</a></li><li><a href="module-SvgManager.html">SvgManager</a></li></ul><h3>Classes</h3><ul><li><a href="DrawObject.html">DrawObject</a></li><li><a href="DrawObjectTree.html">DrawObjectTree</a></li><li><a href="Transform.html">Transform</a></li><li><a href="TransformCommand.html">TransformCommand</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Fri Apr 10 2020 12:04:30 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
